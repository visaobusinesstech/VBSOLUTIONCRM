<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste R√°pido - Invent√°rio</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto; padding: 20px; }
        .container { background: white; padding: 20px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .form-group { margin-bottom: 15px; }
        label { display: block; margin-bottom: 5px; font-weight: bold; }
        input { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px; }
        button { background: #4CAF50; color: white; padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer; margin-right: 10px; }
        button:hover { background: #45a049; }
        .result { margin-top: 20px; padding: 15px; border-radius: 5px; font-family: monospace; white-space: pre-wrap; }
        .success { background: #d4edda; border: 1px solid #c3e6cb; color: #155724; }
        .error { background: #f8d7da; border: 1px solid #f5c6cb; color: #721c24; }
        .info { background: #d1ecf1; border: 1px solid #bee5eb; color: #0c5460; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîß Teste R√°pido - Invent√°rio</h1>
        
        <div class="form-group">
            <label for="supabaseUrl">URL do Supabase:</label>
            <input type="text" id="supabaseUrl" placeholder="https://seu-projeto.supabase.co">
        </div>
        
        <div class="form-group">
            <label for="supabaseKey">Chave Anon:</label>
            <input type="text" id="supabaseKey" placeholder="sua-chave-anon">
        </div>
        
        <button onclick="testQuick()">üöÄ Teste R√°pido</button>
        <button onclick="clearLog()">üóëÔ∏è Limpar</button>
        
        <div id="result"></div>
    </div>

    <script>
        let supabase = null;
        
        function log(message, type = 'info') {
            const resultDiv = document.getElementById('result');
            const timestamp = new Date().toLocaleTimeString();
            resultDiv.innerHTML += `[${timestamp}] ${message}\n`;
            resultDiv.className = `result ${type}`;
        }
        
        function clearLog() {
            document.getElementById('result').innerHTML = '';
        }
        
        async function initSupabase() {
            const url = document.getElementById('supabaseUrl').value;
            const key = document.getElementById('supabaseKey').value;
            
            if (!url || !key) {
                log('‚ùå URL e Chave s√£o obrigat√≥rios!', 'error');
                return false;
            }
            
            try {
                const script = document.createElement('script');
                script.src = 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2';
                document.head.appendChild(script);
                
                await new Promise((resolve, reject) => {
                    script.onload = resolve;
                    script.onerror = reject;
                });
                
                supabase = window.supabase.createClient(url, key);
                log('‚úÖ Supabase inicializado!', 'success');
                return true;
            } catch (error) {
                log(`‚ùå Erro ao inicializar: ${error.message}`, 'error');
                return false;
            }
        }
        
        async function testQuick() {
            clearLog();
            log('üöÄ Iniciando teste r√°pido...', 'info');
            
            if (!await initSupabase()) return;
            
            try {
                // 1. Testar conex√£o
                log('üîç Testando conex√£o...', 'info');
                const { data: testData, error: testError } = await supabase
                    .from('products')
                    .select('count')
                    .limit(1);
                
                if (testError) {
                    log(`‚ùå Erro de conex√£o: ${testError.message}`, 'error');
                    return;
                }
                log('‚úÖ Conex√£o OK!', 'success');
                
                // 2. Testar cria√ß√£o de produto
                log('üì¶ Testando cria√ß√£o de produto...', 'info');
                const productData = {
                    name: 'Teste R√°pido ' + Date.now(),
                    sku: 'QUICK-' + Math.random().toString(36).substr(2, 6).toUpperCase(),
                    category: 'Teste',
                    base_price: 50.00,
                    min_stock: 1,
                    type: 'product',
                    stock: 5
                };
                
                const { data: product, error: productError } = await supabase
                    .from('products')
                    .insert([productData])
                    .select()
                    .single();
                
                if (productError) {
                    log(`‚ùå Erro ao criar produto: ${productError.message}`, 'error');
                    log(`üìã C√≥digo: ${productError.code}`, 'error');
                    return;
                }
                log(`‚úÖ Produto criado: ${product.id}`, 'success');
                
                // 3. Testar cria√ß√£o de invent√°rio
                log('üìã Testando cria√ß√£o de invent√°rio...', 'info');
                const inventoryData = {
                    product_id: product.id,
                    quantity: 5,
                    location: 'Teste'
                };
                
                const { data: inventory, error: inventoryError } = await supabase
                    .from('inventory')
                    .insert([inventoryData])
                    .select(`
                        *,
                        products (
                            id,
                            name,
                            sku,
                            category,
                            base_price
                        )
                    `)
                    .single();
                
                if (inventoryError) {
                    log(`‚ùå Erro ao criar invent√°rio: ${inventoryError.message}`, 'error');
                    log(`üìã C√≥digo: ${inventoryError.code}`, 'error');
                    return;
                }
                log(`‚úÖ Invent√°rio criado: ${inventory.id}`, 'success');
                
                // 4. Testar busca
                log('üîç Testando busca de invent√°rio...', 'info');
                const { data: searchData, error: searchError } = await supabase
                    .from('inventory')
                    .select(`
                        *,
                        products (
                            id,
                            name,
                            sku,
                            category,
                            base_price
                        )
                    `)
                    .order('created_at', { ascending: false });
                
                if (searchError) {
                    log(`‚ùå Erro na busca: ${searchError.message}`, 'error');
                    return;
                }
                log(`‚úÖ Busca OK! Encontrados ${searchData.length} itens`, 'success');
                
                log('üéâ TESTE COMPLETO - TUDO FUNCIONANDO!', 'success');
                
            } catch (error) {
                log(`‚ùå Erro inesperado: ${error.message}`, 'error');
            }
        }
    </script>
</body>
</html>
